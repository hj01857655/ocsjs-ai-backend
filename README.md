# OCSJS AI - æ™ºèƒ½é¢˜åº“ç³»ç»Ÿåç«¯

> **é‡å¤§æ›´æ–°é€šçŸ¥**: æœ¬é¡¹ç›®å·²å‡çº§ä¸ºç¬¬ä¸‰æ–¹APIä»£ç†æ± æ¶æ„ï¼Œæ”¯æŒå¤šä¸ªç¬¬ä¸‰æ–¹APIæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»ã€‚

è¿™æ˜¯ä¸€ä¸ªåŸºäºPythonå’Œå¤šç¬¬ä¸‰æ–¹AI APIçš„æ–°ä¸€ä»£æ™ºèƒ½é¢˜åº“æœåŠ¡åç«¯ï¼Œä¸“ä¸º[OCS (Online Course Script)](https://github.com/ocsjs/ocsjs)è®¾è®¡ï¼Œå¯ä»¥é€šè¿‡AIè‡ªåŠ¨å›ç­”é¢˜ç›®ã€‚æ­¤æœåŠ¡å®ç°äº†ä¸OCS AnswererWrapperå…¼å®¹çš„APIæ¥å£ã€‚

## âš ï¸ é‡è¦æç¤º

> [!IMPORTANT]
> - æœ¬é¡¹ç›®ä»…ä¾›ä¸ªäººå­¦ä¹ ä½¿ç”¨ï¼Œä¸ä¿è¯ç¨³å®šæ€§ï¼Œä¸”ä¸æä¾›ä»»ä½•æŠ€æœ¯æ”¯æŒã€‚
> - ä½¿ç”¨è€…å¿…é¡»åœ¨éµå¾ªå„ç¬¬ä¸‰æ–¹AIæœåŠ¡æä¾›å•†çš„ä½¿ç”¨æ¡æ¬¾ä»¥åŠ**æ³•å¾‹æ³•è§„**çš„æƒ…å†µä¸‹ä½¿ç”¨ï¼Œä¸å¾—ç”¨äºéæ³•ç”¨é€”ã€‚
> - æ ¹æ®[ã€Šç”Ÿæˆå¼äººå·¥æ™ºèƒ½æœåŠ¡ç®¡ç†æš‚è¡ŒåŠæ³•ã€‹](http://www.cac.gov.cn/2023-07/13/c_1690898327029107.htm)çš„è¦æ±‚ï¼Œè¯·å‹¿å¯¹ä¸­å›½åœ°åŒºå…¬ä¼—æä¾›ä¸€åˆ‡æœªç»å¤‡æ¡ˆçš„ç”Ÿæˆå¼äººå·¥æ™ºèƒ½æœåŠ¡ã€‚

## ğŸŒŸ åç«¯åŠŸèƒ½ç‰¹ç‚¹

- ğŸŒ **ç¬¬ä¸‰æ–¹APIä»£ç†æ± **ï¼šæ”¯æŒå¤šä¸ªç¬¬ä¸‰æ–¹APIæœåŠ¡çš„è´Ÿè½½å‡è¡¡å’Œæ•…éšœè½¬ç§»
- ğŸ’¡ **å¤šAIä¾›åº”å•†æ”¯æŒ**ï¼šæ”¯æŒOpenAIã€Anthropicã€Googleç­‰å¤šä¸ªAIä¾›åº”å•†
- ğŸ”„ **OCSå…¼å®¹**ï¼šå®Œå…¨å…¼å®¹OCSçš„AnswererWrapperé¢˜åº“æ¥å£
- ğŸš€ **é«˜æ€§èƒ½ç¼“å­˜**ï¼šRedis + å†…å­˜åŒé‡ç¼“å­˜ï¼Œå¿«é€Ÿå“åº”è¯·æ±‚
- ğŸ”’ **å®‰å…¨å¯é **ï¼šæ”¯æŒè®¿é—®ä»¤ç‰ŒéªŒè¯ï¼Œå®Œæ•´çš„ç”¨æˆ·æƒé™ç®¡ç†
- ğŸ’¬ **å¤šç§é¢˜å‹**ï¼šæ”¯æŒå•é€‰ã€å¤šé€‰ã€åˆ¤æ–­ã€å¡«ç©ºç­‰é¢˜å‹
- ğŸ“Š **æ•°æ®ç»Ÿè®¡**ï¼šå®æ—¶ç›‘æ§æœåŠ¡çŠ¶æ€å’Œä½¿ç”¨æƒ…å†µ
- ğŸ‘¥ **ç”¨æˆ·ç®¡ç†**ï¼šå®Œæ•´çš„ç”¨æˆ·æ³¨å†Œã€ç™»å½•ã€æƒé™ç®¡ç†ç³»ç»Ÿ
- ğŸ”‘ **ä»£ç†æ± ç›‘æ§**ï¼šæ™ºèƒ½ä»£ç†é€‰æ‹©ã€å¯†é’¥è½®æ¢å’Œå®æ—¶ç›‘æ§
- ğŸ–¼ï¸ **å›¾ç‰‡ä»£ç†**ï¼šè§£å†³è¶…æ˜Ÿå¹³å°å›¾ç‰‡403é—®é¢˜
- ğŸ“š **é¢˜åº“ç®¡ç†**ï¼šå®Œæ•´çš„é¢˜åº“å¢åˆ æ”¹æŸ¥å’Œå¯¼å‡ºåŠŸèƒ½
- âš¡ **æ™ºèƒ½æ•…éšœè½¬ç§»**ï¼šè‡ªåŠ¨æ£€æµ‹ä»£ç†çŠ¶æ€ï¼Œæ— ç¼åˆ‡æ¢åˆ°å¯ç”¨ä»£ç†
- ğŸ¯ **è´Ÿè½½å‡è¡¡**ï¼šæ”¯æŒå¤šç§ä»£ç†é€‰æ‹©ç­–ç•¥ï¼Œä¼˜åŒ–æ€§èƒ½å’Œå¯é æ€§

## ğŸ“‹ ç³»ç»Ÿè¦æ±‚

- Python 3.8+ (æ¨è Python 3.9+)
- MySQL 8.0+ (ç”¨äºæ•°æ®å­˜å‚¨)
- Redis (å¯é€‰ï¼Œç”¨äºç¼“å­˜)
- ç¬¬ä¸‰æ–¹AI APIå¯†é’¥ï¼ˆæ”¯æŒOpenAIå…¼å®¹æ¥å£çš„æœåŠ¡ï¼‰

## ğŸš€ å¿«é€Ÿå¼€å§‹

### 1. ç¯å¢ƒå‡†å¤‡

```bash
# åˆ›å»ºè™šæ‹Ÿç¯å¢ƒï¼ˆæ¨èï¼‰
python -m venv venv

# æ¿€æ´»è™šæ‹Ÿç¯å¢ƒ
# Windows
venv\Scripts\activate
# Linux/macOS
source venv/bin/activate

# å®‰è£…ä¾èµ–
pip install -r requirements.txt
```

### 2. é…ç½®æ–‡ä»¶

å¤åˆ¶å¹¶ç¼–è¾‘é…ç½®æ–‡ä»¶ï¼š

```bash
cp config/config.py.example config/config.py
```

ç¼–è¾‘ `config/config.py` æ–‡ä»¶ï¼Œé…ç½®æ•°æ®åº“è¿æ¥å’ŒAPIå¯†é’¥ã€‚

### 3. æ•°æ®åº“åˆå§‹åŒ–

```bash
# åˆ›å»ºæ•°æ®åº“è¡¨
python -c "from models.models import init_db; init_db()"
```

### 4. å¯åŠ¨æœåŠ¡

```bash
# å¼€å‘ç¯å¢ƒ
python app.py

# ç”Ÿäº§ç¯å¢ƒ
gunicorn -w 4 -b 0.0.0.0:5000 app:app
```

## ğŸ“ é¡¹ç›®ç»“æ„

```
backend/
â”œâ”€â”€ app.py                 # ä¸»åº”ç”¨å…¥å£
â”œâ”€â”€ config/                # é…ç½®æ–‡ä»¶
â”‚   â”œâ”€â”€ config.py         # ä¸»é…ç½®æ–‡ä»¶
â”‚   â””â”€â”€ config.py.example # é…ç½®æ¨¡æ¿
â”œâ”€â”€ models/                # æ•°æ®æ¨¡å‹
â”‚   â”œâ”€â”€ models.py         # æ•°æ®åº“æ¨¡å‹å®šä¹‰
â”‚   â””â”€â”€ __init__.py
â”œâ”€â”€ routes/                # APIè·¯ç”±
â”‚   â”œâ”€â”€ auth.py           # è®¤è¯ç›¸å…³è·¯ç”±
â”‚   â”œâ”€â”€ questions.py      # é¢˜ç›®ç›¸å…³è·¯ç”±
â”‚   â”œâ”€â”€ users.py          # ç”¨æˆ·ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ logs.py           # æ—¥å¿—ç®¡ç†è·¯ç”±
â”‚   â”œâ”€â”€ api_proxy_management.py  # APIä»£ç†ç®¡ç†
â”‚   â”œâ”€â”€ proxy_management.py      # ç½‘ç»œä»£ç†ç®¡ç†
â”‚   â”œâ”€â”€ system_monitor.py        # ç³»ç»Ÿç›‘æ§
â”‚   â””â”€â”€ db_monitor.py            # æ•°æ®åº“ç›‘æ§
â”œâ”€â”€ services/              # ä¸šåŠ¡æœåŠ¡
â”‚   â”œâ”€â”€ ai_service.py     # AIæœåŠ¡æ ¸å¿ƒ
â”‚   â”œâ”€â”€ api_proxy_pool.py # APIä»£ç†æ± 
â”‚   â”œâ”€â”€ cache.py          # ç¼“å­˜æœåŠ¡
â”‚   â””â”€â”€ search.py         # æœç´¢æœåŠ¡
â”œâ”€â”€ utils/                 # å·¥å…·å‡½æ•°
â”‚   â”œâ”€â”€ auth.py           # è®¤è¯å·¥å…·
â”‚   â”œâ”€â”€ logger.py         # æ—¥å¿—å·¥å…·
â”‚   â”œâ”€â”€ db_monitor.py     # æ•°æ®åº“ç›‘æ§å·¥å…·
â”‚   â”œâ”€â”€ system_monitor.py # ç³»ç»Ÿç›‘æ§å·¥å…·
â”‚   â””â”€â”€ error_handler.py  # é”™è¯¯å¤„ç†å·¥å…·
â”œâ”€â”€ scripts/               # è„šæœ¬æ–‡ä»¶
â”œâ”€â”€ logs/                  # æ—¥å¿—æ–‡ä»¶
â”œâ”€â”€ requirements.txt       # Pythonä¾èµ–
â””â”€â”€ README.md             # é¡¹ç›®æ–‡æ¡£
```

## ğŸ”§ APIæ¥å£

### è®¤è¯æ¥å£

- `POST /api/auth/login` - ç”¨æˆ·ç™»å½•
- `POST /api/auth/register` - ç”¨æˆ·æ³¨å†Œ
- `POST /api/auth/logout` - ç”¨æˆ·ç™»å‡º

### é¢˜ç›®æœç´¢æ¥å£

- `POST /api/questions/search` - æœç´¢é¢˜ç›®ç­”æ¡ˆ
- `POST /api/questions/batch-search` - æ‰¹é‡æœç´¢é¢˜ç›®

### ç®¡ç†æ¥å£

- `GET /api/system-monitor/stats` - è·å–ç³»ç»ŸçŠ¶æ€
- `GET /api/db-monitor/health` - æ•°æ®åº“å¥åº·æ£€æŸ¥
- `GET /api/api-proxy-management/status` - APIä»£ç†çŠ¶æ€

### å¥åº·æ£€æŸ¥

- `GET /health` - æœåŠ¡å¥åº·æ£€æŸ¥

## ğŸ”§ é…ç½®è¯´æ˜

### æ•°æ®åº“é…ç½®

```python
DATABASE_CONFIG = {
    'host': 'localhost',
    'port': 3306,
    'user': 'your_username',
    'password': 'your_password',
    'database': 'edubrain_ai'
}
```

### APIä»£ç†æ± é…ç½®

```python
API_PROXIES = [
    {
        'name': 'openai-proxy-1',
        'base_url': 'https://api.openai.com/v1',
        'api_key': 'your-api-key',
        'model': 'gpt-4o-mini',
        'priority': 1
    }
]
```

## ğŸš€ éƒ¨ç½²æŒ‡å—

### Dockeréƒ¨ç½²

```bash
# æ„å»ºé•œåƒ
docker build -t edubrain-backend .

# è¿è¡Œå®¹å™¨
docker run -d -p 5000:5000 \
  -e DATABASE_URL=mysql://user:pass@host:3306/db \
  edubrain-backend
```

### ç³»ç»ŸæœåŠ¡éƒ¨ç½²

```bash
# åˆ›å»ºsystemdæœåŠ¡æ–‡ä»¶
sudo cp scripts/edubrain-backend.service /etc/systemd/system/

# å¯åŠ¨æœåŠ¡
sudo systemctl enable edubrain-backend
sudo systemctl start edubrain-backend
```

## ğŸ“Š ç›‘æ§å’Œæ—¥å¿—

- ç³»ç»Ÿç›‘æ§ï¼š`/api/system-monitor/stats`
- æ•°æ®åº“ç›‘æ§ï¼š`/api/db-monitor/health`
- æ—¥å¿—æ–‡ä»¶ï¼š`logs/` ç›®å½•
- é”™è¯¯è¿½è¸ªï¼šé›†æˆçš„é”™è¯¯å¤„ç†å’Œæ—¥å¿—è®°å½•

## ğŸ¤ å¼€å‘æŒ‡å—

### ä»£ç è§„èŒƒ

- éµå¾ªPEP 8 Pythonä»£ç è§„èŒƒ
- ä½¿ç”¨ç±»å‹æç¤º
- ç¼–å†™å•å…ƒæµ‹è¯•
- æ·»åŠ é€‚å½“çš„æ–‡æ¡£å­—ç¬¦ä¸²

### æµ‹è¯•

```bash
# è¿è¡Œæµ‹è¯•
python -m pytest tests/

# ä»£ç è¦†ç›–ç‡
python -m pytest --cov=. tests/
```

## ğŸ“„ è®¸å¯è¯

æœ¬é¡¹ç›®ä»…ä¾›å­¦ä¹ å’Œç ”ç©¶ä½¿ç”¨ã€‚

## ğŸ”— ç›¸å…³é“¾æ¥

- [å‰ç«¯é¡¹ç›®](https://github.com/hj01857655/ocsjs-ai-frontend)
- [OCSé¡¹ç›®](https://github.com/ocsjs/ocsjs)
- [APIæ–‡æ¡£](./docs/api.md)

---

**æœ€åæ›´æ–°**: 2025-01-25
**ç‰ˆæœ¬**: v2.0.0
**ç»´æŠ¤è€…**: OCSJS AI Team
